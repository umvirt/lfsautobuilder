ULFS LFS Autobuild
------------------

Automated LFS build. Downloads and builds base image.

Directory structure

- books
    - wget-list
    - md5sums
- src
- tmp

- downloadsrc - downloads source code files and put them in src folder. Log is stored in tmp/wget.log
- checksrc - check source code files and print report.
- dlist.php - wget-list parser. needed to get wanted files by checksrc.

Runing

# Download wget-list & md5sums from LFS site and put in books directory
# Run downloadsrc to get source code packages
# Run checksrc to perform integrity check

# create hard drive image
qemu-img create -f raw hdd.img 10G

# create patition 

fdisk hdd.img 

Welcome to fdisk (util-linux 2.32.1).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table.
Created a new DOS disklabel with disk identifier 0x4181d3fb.

Command (m for help): p
Disk hdd.img: 10 GiB, 10737418240 bytes, 20971520 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x4181d3fb

Command (m for help): n
Partition type
   p   primary (0 primary, 0 extended, 4 free)
   e   extended (container for logical partitions)
Select (default p): p
Partition number (1-4, default 1): 1
First sector (2048-20971519, default 2048): 
Last sector, +sectors or +size{K,M,G,T,P} (2048-20971519, default 20971519): 

Created a new partition 1 of type 'Linux' and of size 10 GiB.

Command (m for help): w
The partition table has been altered.
Syncing disks.


#add loop
kpartx -av tmp/hdd.img

add map loop3p1 (252:21): 0 20969472 linear 7:3 2048



#format loop
mkfs.ext4 /dev/mapper/loop3p1

mke2fs 1.44.3 (10-July-2018)
Discarding device blocks: done                            
Creating filesystem with 2621184 4k blocks and 655360 inodes
Filesystem UUID: 23fd6ba2-419a-4bca-9c31-4a7ef8e01d63
Superblock backups stored on blocks: 
    32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (16384 blocks): done
Writing superblocks and filesystem accounting information: done 


#mount loop
mount /dev/mapper/loop3p1 builddir

#copy sources
./copysrc

#create dirs
./initdirs



#create user lfs
./adduser

#chown all to lfs
./chown2user

#login as lfs
su - lfs

#load user environment
. userenv.sh

#check user environment
set | grep LFS

#run each script from scripts directory in alphabetic order. 

#logout from lfs user

#make backup


